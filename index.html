<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liturgia del D√≠a</title>
    <meta name="description" content="Liturgia cat√≥lica diaria con lecturas y oraciones">
    
    <!-- Headers para permitir iframe embedding -->
    <meta http-equiv="Content-Security-Policy" content="frame-ancestors *;">
    <meta http-equiv="X-Frame-Options" content="ALLOWALL">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Georgia, 'Times New Roman', serif;
            background: #f8f9fa;
            padding: 5px;
            min-height: 100vh;
        }
        
        .liturgy-container {
            max-width: 100%;
            margin: 0 auto;
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
            border: 1px solid #e8eaed;
            overflow: hidden;
        }

        .liturgy-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px 15px;
            text-align: center;
            color: white;
        }

        .liturgy-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 6px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .liturgy-subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 12px;
        }

        .date-badge {
            font-size: 0.8rem;
            background: rgba(255,255,255,0.2);
            padding: 6px 12px;
            border-radius: 15px;
            display: inline-block;
            backdrop-filter: blur(10px);
        }

        .loading {
            padding: 30px;
            text-align: center;
            background: #fafafa;
        }

        .spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .content-section {
            background: #ffffff;
            padding: 15px;
            border-bottom: 1px solid #f1f3f4;
        }

        .content-section:last-child {
            border-bottom: none;
        }

        .date-card {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border: 1px solid #e8eaed;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
        }

        .date-title {
            font-size: 1.2rem;
            color: #2c3e50;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .season-info {
            font-size: 0.9rem;
            color: #667eea;
            font-style: italic;
            font-weight: 500;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .celebration-item {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #667eea;
            margin-bottom: 12px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
        }

        .celebration-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 4px;
        }

        .celebration-rank {
            color: #6c757d;
            font-size: 0.8rem;
            margin-bottom: 8px;
        }

        .color-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .reading-item {
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border-radius: 8px;
            border-left: 4px solid #667eea;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
        }

        .reading-header {
            margin-bottom: 12px;
        }

        .reading-type {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-right: 8px;
            display: inline-block;
            margin-bottom: 6px;
        }

        .reading-citation {
            font-weight: 700;
            color: #e74c3c;
            font-size: 1rem;
            display: block;
        }

        .reading-text {
            color: #2c3e50;
            line-height: 1.6;
            font-size: 0.9rem;
            text-align: justify;
            padding: 12px;
            background: white;
            border-radius: 6px;
            border: 1px solid #f1f3f4;
        }

        .psalm-item {
            padding: 15px;
            background: linear-gradient(135deg, #f4f1f8, #ffffff);
            border-radius: 8px;
            border-left: 4px solid #9c27b0;
            margin-bottom: 12px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
        }

        .psalm-citation {
            font-weight: 700;
            color: #9c27b0;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .psalm-text {
            color: #2c3e50;
            line-height: 1.6;
            font-style: italic;
            font-size: 0.9rem;
            text-align: justify;
        }

        .error-notice {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            margin: 15px;
            border-radius: 8px;
            font-size: 0.85rem;
            border-left: 4px solid #f39c12;
        }

        .footer-info {
            background: #f8f9fa;
            padding: 12px;
            text-align: center;
            font-size: 0.75rem;
            color: #6c757d;
            border-top: 1px solid #e9ecef;
        }

        .iframe-friendly {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 8px;
        }

        /* Optimizaciones para iframe */
        @media (max-width: 768px) {
            body {
                padding: 2px;
            }
            
            .liturgy-title {
                font-size: 1.6rem;
            }
            
            .content-section {
                padding: 12px;
            }
            
            .reading-text, .psalm-text {
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <div class="liturgy-container">
        <div class="liturgy-header">
            <div class="iframe-friendly">üîó Optimizado para iframe</div>
            <h1 class="liturgy-title">‚úùÔ∏è Liturgia del D√≠a</h1>
            <p class="liturgy-subtitle">Lecturas y oraciones lit√∫rgicas cat√≥licas</p>
            <div class="date-badge" id="dateBadge">üìÖ Cargando...</div>
        </div>

        <div id="loading" class="loading">
            <div class="spinner"></div>
            <div style="color: #667eea; font-size: 1rem; font-weight: 500;">üôè Cargando liturgia del d√≠a...</div>
            <div style="color: #6c757d; font-size: 0.8rem; margin-top: 8px;">Conectando con liturgy.day</div>
        </div>

        <div id="errorNotice" class="error-notice" style="display: none;">
            <strong>‚ÑπÔ∏è Informaci√≥n:</strong> No se pudo conectar con la API de liturgy.day. Mostrando contenido lit√∫rgico de ejemplo para demostraci√≥n.
        </div>

        <div id="content" style="display: none;"></div>
        
        <div class="footer-info">
            <div>üìñ Datos lit√∫rgicos de <strong>liturgy.day</strong></div>
            <div style="margin-top: 4px;">üîó Compatible con iframe embedding</div>
        </div>
    </div>

    <script>
        (function() {
            'use strict';
            
            // Configurar headers para iframe
            if (window.self !== window.top) {
                console.log('üîó Ejecut√°ndose dentro de un iframe');
            }
            
            const dateBadge = document.getElementById('dateBadge');
            const loading = document.getElementById('loading');
            const errorNotice = document.getElementById('errorNotice');
            const content = document.getElementById('content');
            
            const fallbackData = {
                date: new Date().toISOString().split('T')[0],
                season: "Tiempo Ordinario",
                celebrations: [
                    {
                        title: "San Juan Bosco, presb√≠tero",
                        rank: "Memoria",
                        colour: "Blanco"
                    }
                ],
                readings: [
                    {
                        citation: "2 Samuel 7, 4-17",
                        reading: "En aquellos d√≠as, el Se√±or dirigi√≥ esta palabra a Nat√°n: ¬´Ve y dile a mi siervo David: 'As√≠ dice el Se√±or: ¬øVas a ser t√∫ quien me construya una casa para que habite en ella? Desde el d√≠a en que saqu√© a los israelitas de Egipto hasta hoy, no he habitado en casa alguna, sino que he ido de ac√° para all√°, en una tienda de campa√±a.'¬ª",
                        type: "Primera Lectura"
                    },
                    {
                        citation: "Marcos 4, 1-20",
                        reading: "En aquel tiempo, Jes√∫s se puso a ense√±ar a orillas del lago. Acudi√≥ a √©l un gent√≠o tan grande, que tuvo que subirse a una barca; se sent√≥ en ella, y toda la gente se qued√≥ en tierra, junto a la orilla del lago. Les ense√±aba muchas cosas por medio de par√°bolas.",
                        type: "Evangelio"
                    }
                ],
                psalms: [
                    {
                        citation: "Salmo 88, 4-5. 27-28. 29-30",
                        psalm: "R/. Cantar√© eternamente las misericordias del Se√±or.\n\nSell√© una alianza con mi elegido,\njurando a David, mi siervo:\n¬´Te fundar√© un linaje perpetuo,\nedificar√© tu trono para todas las edades.¬ª R/."
                    }
                ]
            };
            
            function formatDate(dateString) {
                const date = new Date(dateString + 'T00:00:00');
                return date.toLocaleDateString('es-ES', {
                    weekday: 'long',
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });
            }
            
            function getColorStyle(colour) {
                const colorMap = {
                    'Verde': { bg: '#d4edda', color: '#155724' },
                    'Rojo': { bg: '#f8d7da', color: '#721c24' },
                    'Blanco': { bg: '#f8f9fa', color: '#495057' },
                    'Morado': { bg: '#e2d9f3', color: '#4a148c' },
                    'Rosa': { bg: '#f8d7da', color: '#721c24' }
                };
                return colorMap[colour] || { bg: '#e9ecef', color: '#495057' };
            }
            
            function renderContent(data) {
                const formattedDate = formatDate(data.date);
                
                let html = `
                    <div class="content-section">
                        <div class="date-card">
                            <div class="date-title">${formattedDate}</div>
                            <div class="season-info">${data.season || 'Tiempo Lit√∫rgico'}</div>
                        </div>
                    </div>
                `;
                
                if (data.celebrations && data.celebrations.length > 0) {
                    html += `<div class="content-section">
                        <h3 class="section-title">üéâ Celebraciones</h3>`;
                    
                    data.celebrations.forEach(celebration => {
                        const colorStyle = getColorStyle(celebration.colour);
                        html += `
                            <div class="celebration-item">
                                <div class="celebration-title">${celebration.title}</div>
                                <div class="celebration-rank">${celebration.rank}</div>
                                <span class="color-badge" style="background: ${colorStyle.bg}; color: ${colorStyle.color};">${celebration.colour}</span>
                            </div>
                        `;
                    });
                    
                    html += `</div>`;
                }
                
                if (data.readings && data.readings.length > 0) {
                    html += `<div class="content-section">
                        <h3 class="section-title">üìñ Lecturas B√≠blicas</h3>`;
                    
                    data.readings.forEach(reading => {
                        html += `
                            <div class="reading-item">
                                <div class="reading-header">
                                    <span class="reading-type">${reading.type}</span>
                                    <span class="reading-citation">${reading.citation}</span>
                                </div>
                                <div class="reading-text">${reading.reading}</div>
                            </div>
                        `;
                    });
                    
                    html += `</div>`;
                }
                
                if (data.psalms && data.psalms.length > 0) {
                    html += `<div class="content-section">
                        <h3 class="section-title">üôè Salmos Responsoriales</h3>`;
                    
                    data.psalms.forEach(psalm => {
                        html += `
                            <div class="psalm-item">
                                <div class="psalm-citation">${psalm.citation}</div>
                                <div class="psalm-text">${psalm.psalm.replace(/\n/g, '<br>')}</div>
                            </div>
                        `;
                    });
                    
                    html += `</div>`;
                }
                
                content.innerHTML = html;
            }
            
            async function loadLiturgy() {
                const today = new Date().toISOString().split('T')[0];
                
                dateBadge.textContent = 'üìÖ ' + new Date().toLocaleDateString('es-ES', {
                    day: 'numeric',
                    month: 'long'
                });
                
                try {
                    const response = await fetch(`https://liturgy.day/api/v1/calendar/${today}`);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data && (data.readings || data.celebrations || data.psalms)) {
                        renderContent(data);
                    } else {
                        throw new Error('Datos incompletos de la API');
                    }
                    
                } catch (error) {
                    console.warn('‚ö†Ô∏è Error con API, usando datos de ejemplo:', error);
                    errorNotice.style.display = 'block';
                    renderContent(fallbackData);
                } finally {
                    loading.style.display = 'none';
                    content.style.display = 'block';
                }
            }
            
            // Inicializar
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', loadLiturgy);
            } else {
                loadLiturgy();
            }
            
        })();
    </script>
</body>
</html>
